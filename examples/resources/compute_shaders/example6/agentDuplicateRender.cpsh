#version 430 core

#define PI 3.14159265358979

layout(local_size_x = 1, local_size_y = 1) in;
layout(rgba16f, binding = 0, location = 0) uniform image2D img_output;
layout(rgba16f, binding = 1, location = 1) uniform image2D trails;

uniform vec3 invocation_dimensions=vec3(0);
uniform vec2 image_size=vec2(0);

layout (std140) buffer balls_buffer {
	vec4 balls[];
};

float rand(float fli) {
	uint i=uint(fli);
	i^=2747636419u;
	i*=2654435769u;
	i^=i>>16;
	i*=2654435769u;
	i^=i>>16;
	i*=2654435769u;
	return fract(float(i)/4294967295.0);
}

void main() {
	ivec3 coords=ivec3(gl_GlobalInvocationID.xyz);
	ivec2 pixel_coords=ivec2(balls[coords.x].xy);
	
	vec3 prevColor=imageLoad(trails,pixel_coords).xyz;
	float v=prevColor.r;
	imageStore(img_output, pixel_coords, vec4(normalize(vec3(0,v,1))*length(vec3(1,1,1)),1));
}